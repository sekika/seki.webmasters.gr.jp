#!/bin/sh
#
# tDiary のテーマディレクトリに、テーマサンプルのhtmlを生成する。
#
# 使い方： sh tDiaryTheme.txt テーマディレクトリ
#
# Title: tDiaryTheme.txt
# Author: Seki
# Access: http://home.att.ne.jp/wood/seki/
# Download: http://home.att.ne.jp/wood/seki/sh/tDiaryTheme.html
# License: GPL
#
# テーマギャラリー (http://www.tdiary.org/20021001.html) のhtmlを
# 流用しています。
#
# $Id: tDiaryTheme.txt,v 2.1 2003/09/05 07:44:53 seki Exp $

# テーマディレクトリのチェック

dir=$1

if [ -z $dir ]; then
  echo "tDiaryTheme: ディレクトリが見つかりません"
  echo "使い方: sh $0 テーマディレクトリ"
  exit 1
fi

if [ -d $dir ]; then
  :
else
  echo "tDiaryTheme: ディレクトリが見つかりません"
  echo "使い方: sh $0 テーマディレクトリ"
  exit 1
fi

# 一時ファイルを確保

sidebar=$dir/sidebar.tmp

# .htaccess

echo "DirectoryIndex index.html" > $dir/.htaccess

# index.htmlを生成

index=$dir/index.html

date=`date`
cat <<EOF > $index
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="ja-JP">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=EUC-JP">
  <link rel="start" title="top" href="http://home.att.ne.jp/wood/seki/sh/tDiaryTheme.html">
  <meta http-equiv="content-style-type" content="text/css">
  <link rel="stylesheet" href="default/default.css" type="text/css" media="all">
  <title>tDiary テーマ・サンプル</title>
</head>
<body>

<h1>tDiary テーマ・サンプル</h1>

<div class="main">
<div class="day">

<h2><span class="title">テーマサンプルページ</span></h2>

<div class="body">

<div class="section">
<h3 class="subtitle"><span class="sanchor">_</span> このページは</h3>
<p>このページは、<a href="http://www.tdiary.org/">tDiary</a>でテーマが実際にどのように見えるかを確認するためのページです。以下のインデックスから、各テーマのサンプルを選ぶことができます。</p>
<p>実際に確認しながら、自分の好みのテーマを見つけてください。</p>

<p><a href="http://home.att.ne.jp/wood/seki/sh/tDiaryTheme.html">tDiaryTheme</a>を使うと、このようなページを自動的に生成することができます。</p>
</div>

<div class="section">
<table summary="tDiary Theme samples">
<tr>
<td>サンプル</td>
<td>タイトル</td>
<td>著者</td>
<td>コメント</td>
<td>Sidebar</td>
<td>Calendar3</td>
</tr>
EOF

for i in `ls $dir/*/*.css`
do
  css=`echo $i | sed -e 's/.*\///' | sed -e 's/\.css//'`
  title=`cat $dir/$css/README | grep Title | head -n 1 | sed -e 's/Title: //'`
  author=`cat $dir/$css/README | grep Author | head -n 1 | sed -e 's/Author: //' | sed -e 's/<.*>//'`
  comment=`cat $dir/$css/README | grep Comment | head -n 1 | sed -e 's/Comment: //'`
  echo "<tr>" >> $index
  echo "<td><a href=\"$css/$css.html\">$css</a></td>" >> $index
  echo "<td>$title</td>" >> $index
  echo "<td>$author</td>" >> $index
  echo "<td>$comment</td>" >> $index
  side=`cat $dir/$css/$css.css | grep "div.sidebar" | head -n 1`
  if [ -z "$side" ]; then
    echo "<td>-</td>" >> $index
  else
    echo "<td>OK</td>" >> $index
  fi
  cal=`cat $dir/$css/$css.css | grep "calendar-popup" | head -n 1`
  if [ -z "$cal" ]; then
    echo "<td>-</td>" >> $index
  else
    echo "<td>OK</td>" >> $index
  fi
  echo "</tr>" >> $index
done

Revision=revision

cat <<EOF | sed -e "s/UPDATE/$date/" >> $index
</table>

</div>
</div>
</div>
</div>

<div class="footer">
HTML generated by <a href="http://home.att.ne.jp/wood/seki/sh/tDiaryTheme.html">tDiaryTheme</a> $Revision: 2.1 $null on UPDATE
</div>
</body>
</html>
EOF

# サイドバーを生成

echo "テーマ一覧" > $sidebar
echo "<ul>" >> $sidebar
for i in `ls $dir/*/*.css`
do
  css=`echo $i | sed -e 's/.*\///' | sed -e 's/\.css//'`
  echo "<li><a href=\"../$css/$css.html\">$css</a></li>" >> $sidebar
done
echo "</ul>" >> $sidebar

# メイン

for i in `ls $dir/*/*.css`
do
  css=`echo $i | sed -e 's/.*\///' | sed -e 's/\.css//'`
  echo "DirectoryIndex $css.html" > $dir/$css/.htaccess
  title=`cat $dir/$css/README | grep Title | head -n 1 | sed -e 's/Title: //'`

cat <<EOF | sed -e "s/CSSFILE/$css/" | sed -e "s/TITLE/$title/" > $dir/$css/$css.html
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="ja-JP">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=EUC-JP">
  <link rel="start" title="top" href="http://home.att.ne.jp/wood/seki/sh/tDiaryTheme.html">
  <meta http-equiv="content-style-type" content="text/css">
  <link rel="stylesheet" href="CSSFILE.css" type="text/css" media="all">
  <title>TITLE テーマ・サンプル</title>
</head>
<body>

<div class="adminmenu">
<span class="adminmenu"><a href="../index.html">トップ</a></span>
<span class="adminmenu"><a href="../index.html">最新</a></span>
<span class="adminmenu"><a href="../index.html">更新</a></span>
</div>

<h1>TITLE テーマ・サンプル</h1>

<div class="main"> 
<div class="calendar">
<div class="year">2001|<a href="../index.html">01</a>|<a href="../index.html">02</a>|<a href="../index.html">03</a>|<a href="../index.html">04</a>|<a href="../index.html">05</a>|<a href="../index.html">06</a>|<a href="../index.html">07</a>|<a href="../index.html">08</a>|<a href="../index.html">09</a>|<a href="../index.html">10</a>|<a href="../index.html">11</a>|<a href="../index.html">12</a>|</div>
<div class="year">2002|<a href="../index.html">01</a>|<a href="../index.html">02</a>|<a href="../index.html">03</a>|</div>
</div>

<hr class="sep">

<div class="day">
<h2><span class="date"><a href="../index.html">2002-04-01</a></span> <span class="title">テーマサンプルページ</span></h2>

<div class="body">

<div class="section">
<h3 class="subtitle"><a href="../index.html"><span class="sanchor">_</span></a> このページは</h3>
<p>このページは、<a href="http://www.tdiary.org/">tDiary</a>でTITLEテーマが実際にどのように見えるかを確認するためのページです。このテーマを使って日記を書くと、このページで見えているのとまったく同じようになります。</p>
<p>実際に確認しながら、自分の好みのテーマを見つけてください。</p>
</div>
<div class="section">
<p><a href="./20020315.html#p02"><span class="panchor">_</span></a> この段落の左端や、上のサブタイトルの横には、セクションアンカーが、下のツッコミの横にはツッコミアンカーがそれぞれついています。イメージアンカー対応のテーマでは、ここが画像になっています。そうでないテーマの場合は目立たない「_」が見えているはずです。</p>
</div>

<div class="section">
<p><a href="http://www.tdiary.org/download/theme/CSSFILE.tar.gz">TITLEをダウンロードする</a></p>

<blockquote>
<p>引用 (blockquote) はこのように見えます。</p>
</blockquote>

<pre>
READMEファイルより:

EOF

cat $dir/$css/README | sed -e 's/</\&lt;/g' | sed -e 's/>/\&gt;/g' >> $dir/$css/$css.html

cat <<EOF >> $dir/$css/$css.html
</pre>

</div>

</div>

<div class="comment">
<div class="caption">本日のツッコミ(全2件) [<a href="../index.html">ツッコミを入れる</a>]</div>
<div class="commentshort">
<p><a href="../index.html"><span class="canchor">_</span></a>
<span class="commentator">名なしさん</span>&nbsp;[初めてツッコミさせてもらいます]</p>
<p><a href="../index.html"><span class="canchor">_</span></a>
<span class="commentator">名なし</span>&nbsp;[長いツッコミが入ると、後半部分が省略表示されるようになっているんですね。これなら長いツッコミが入っ...]</p>
</div>
</div>
</div>
<div class="referer">
本日のリンク元 | <a href="../index.html" title="/">22</a> | <a href="../" title="/20020315.html">19</a> | <a href="../index.html" title="/update.rb">9</a> | <a href="../index.html" title="/20020314.html">8</a> | <a href="../index.html" title="http://pichu-sho.yk.hst.fujitsu.com/">3</a> | <a href="../index.html" title="/200203.html">2</a> | <a href="../index.html" title="/20020313.html">1</a> |
		
</div>

<hr class="sep">

</div>
<div class="sidebar">

EOF

cat $sidebar >> $dir/$css/$css.html

cat <<EOF | sed -e "s/UPDATE/$date/" >> $dir/$css/$css.html
</div>

<div class="footer">
HTML generated by <a href="http://home.att.ne.jp/wood/seki/sh/tDiaryTheme.html">tDiaryTheme</a> $Revision: 2.1 $null on UPDATE
</div>
</body>
</html>

EOF

done 

rm -f $sidebar

